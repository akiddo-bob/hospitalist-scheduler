# Long Call Assignment Rules

## Long Call Shifts

### Weekdays (Monday - Friday)
1. Teaching Long Call (5p-7p)
2. Direct Care Long Call 1 AM (7a-8a) + PM (5p-7p) — same provider does both the morning and evening portion
3. Direct Care Long Call 2 PM (5p-7p)

### Weekends and Holidays (Saturday, Sunday, observed holidays)
1. Teaching Long Call (5p-7p)
2. Direct Care Long Call 2 PM (5p-7p)

### Holidays
- Treated like weekends (2 long call shifts instead of 3), even if the holiday falls on a weekday
- Holiday long calls count as **weekend long calls** for purposes of the weekend limit rule
- Holidays in this block: **Memorial Day (May 25, 2026)**
- Full holiday list (for tracking across blocks):
  1. New Year's Day
  2. Memorial Day
  3. July 4th (Independence Day)
  4. Labor Day
  5. Thanksgiving
  6. Christmas
- Do not assign the same provider to holiday long call more than once across blocks — spread holiday assignments across different providers (6 holidays per year, rotate through providers)

## Service Categories

### Teaching Services
- HA, HB, HC, HD, HE, HF, HG, HM (Family Medicine)
- Providers on these services should **preferentially** get Teaching Long Call

### Direct Care Services
- H1, H2, H3, H4, H5, H6, H7
- H8- Pav 6 & EXAU, H9, H10, H11
- H12- Pav 8 & Pav 9, H13- (Obs overflow), H14
- H15, H16, H17, H18
- Providers on these services get Direct Care Long Call 1 or 2

## Definitions

- **Week**: Monday through Friday. The basic unit for "weeks worked" and proportional LC assignment.
- **Weekend**: Saturday and Sunday. Weekends do not count as "weeks worked."
- **Stretch**: A run of consecutive source-service days that includes **at least one weekday** (Mon-Fri). A stretch may include attached weekends (e.g., Mon-Sun or Sat-Fri). Only source services (HA-HG, HM, H1-H18) count — non-source services (UM, SAH, etc.) are invisible and do not connect or extend stretches.
- **Standalone weekend**: A Saturday-Sunday (or single Sat/Sun) on a source service with **no adjacent source-service weekdays**. A standalone weekend is **not** a stretch. It does not count as a "week worked." It is deprioritized for long call assignment.
- **Weeks worked**: The count of Mon-Fri blocks within real stretches (not standalone weekends). This is the number used for proportional balancing.

## Assignment Logic

### Step 1: Identify work stretches
- Determine each provider's consecutive working days on **source services only** (non-source services are invisible)
- Classify each group of consecutive source-service days:
  - If it contains at least one weekday (Mon-Fri) → it is a **stretch**
  - If it contains only weekend days (Sat/Sun) with no adjacent weekdays → it is a **standalone weekend**
- Stretches may vary: some are 5 days (Mon-Fri), some 7 days (Mon-Sun or Sat-Fri), some longer
- A stretch that spans both weekdays and a weekend counts as one stretch
- Long stretches (>7 days) are split into week-sized chunks for assignment purposes

### Step 2: Assign one long call per stretch
- **Goal: Every provider gets exactly 1 long call per work stretch (per week within the stretch if >7 days)**
- If a stretch includes both weekdays and weekend days, the provider still only gets 1 long call total for that stretch
- **Standalone weekends** are eligible for long call but are **deprioritized** — prefer assigning during real stretches first
- **Minimum guarantee**: If a provider works at least one week that contains weekdays (not weekend-only), they **must** get at least 1 long call in the block. Standalone weekends do not require a long call assignment.

### Step 3: Teaching vs Direct Care preference
- Teaching service providers (HA-HG, HM) → preferentially assigned to Teaching Long Call
- Direct care service providers (H1-H18) → assigned to Direct Care Long Call 1 or 2
- **Overflow**: If there are too many teaching providers for the Teaching Long Call slot, some teaching providers will be assigned to Direct Care Long Call slots instead

### Step 4: Weekend long call limits
- **Maximum 1 weekend long call per provider across the entire 4-month block (March-June)**
- If someone must do a second weekend long call due to staffing shortages, flag/highlight it
- **Weekend surplus**: If there are more eligible providers than weekend long call slots, preferentially **skip** the provider who has the **fewest total weekends worked** in the block (protect providers with fewer weekends from getting weekend long call)

### Step 5: Handling surpluses (too many providers, not enough slots)
- If there are more providers than long call slots in a given week, some providers will **not get a long call** that week
- **Surplus priority**: When deciding who to skip, preferentially give the break to providers who work the **most weeks** in the block — they have more opportunities to make it up later. Protect providers working fewer weeks.
- **Consecutive-week limit**: No provider should go more than **1 consecutive week without a long call**. If a provider just went a week without a long call, they must be prioritized for assignment in the next week.
- **Highlight/flag** any provider who has no long call in a given work stretch
- Providers who missed a long call in a previous stretch should be **preferentially chosen** to take a double long call in a future week if needed

### Step 6: Handling shortages (double long calls)
- If there aren't enough providers in a given week and someone must have 2 long calls in one stretch:
  - One should be on a **weekday**, one on a **weekend**
  - **Highlight/flag** the provider who has 2 long calls
  - **Preferentially assign the double** to someone who previously missed a long call (from a surplus week)
  - If no one has a missed long call to make up, distribute double long calls **fairly and equally** across the block — don't burden the same person repeatedly

### Step 6: Evenly distribute Direct Care 1 vs 2
- When assigning Direct Care Long Call, **distribute evenly and fairly** between Long Call 1 and Long Call 2 for each provider across the block
- Don't always put the same person on Long Call 1 vs Long Call 2 — alternate/balance over time

### Step 7: Two consecutive weeks = two long calls
- If a provider is working **two consecutive weeks in a row**, they should get **one long call per week** (2 total)
- Each long call should fall in a different week of their stretch

### Step 8: Distribute long call days of week evenly
- Across the 4-month block, **vary the day of the week** each provider is assigned long call
- Don't assign the same provider to long call on the same day of the week repeatedly
- Spread long call assignments across different weekdays for each provider

## Source Services (shifts to examine for eligibility)
All 8a-5p daytime hospitalist services:

| Category | Service | Hours |
|----------|---------|-------|
| Teaching | HA | 8a-5p |
| Teaching | HB | 8a-5p |
| Teaching | HC | 8a-5p |
| Teaching | HD | 8a-5p |
| Teaching | HE | 8a-5p |
| Teaching | HF | 8a-5p |
| Teaching | HG | 8a-5p |
| Teaching | HM (Family Medicine) | 8a-5p |
| Direct Care | H1 | 8a-5p |
| Direct Care | H2 | 8a-5p |
| Direct Care | H3 | 8a-5p |
| Direct Care | H4 | 8a-5p |
| Direct Care | H5 | 8a-5p |
| Direct Care | H6 | 8a-5p |
| Direct Care | H7 | 8a-5p |
| Direct Care | H8- Pav 6 & EXAU | 8a-5p |
| Direct Care | H9 | 8a-5p |
| Direct Care | H10 | 8a-5p |
| Direct Care | H11 | 8a-5p |
| Direct Care | H12- Pav 8 & Pav 9 | 8a-5p |
| Direct Care | H13- (Obs overflow) | 8a-5p |
| Direct Care | H14 | 8a-5p |
| Direct Care | H15 | 8a-5p |
| Direct Care | H16 | 8a-5p |
| Direct Care | H17 | 8a-5p |
| Direct Care | H18 | 8a-5p |

## Exclusions / Constraints
- Excluded providers are defined in `config.json` and are ignored from all long call assignments
- Exclude moonlighters: If a provider is moonlighting during a work stretch, they are **excluded from long call** for that entire stretch

## Fundamental Balancing Principle
- The block runs **March 2 through June 28, 2026**
- Across the entire block, every non-excluded provider should have long call assignments **proportional to the number of weeks they are working**
- Example: A provider working 8 weeks in the block should have roughly 8 long calls; a provider working 4 weeks should have roughly 4
- This is the overarching fairness goal — all other rules operate in service of this balance

## Rule Violations
- If any rule/limit **must be violated** to fill the schedule, that is acceptable
- All violations must be **highlighted and called out** so they can be reviewed

## Notes
- Moonlighting shifts are flagged with the "extra pay" icon (xpay_dull.gif) in Amion
- At ~$1,500/moonlighting shift, March-June 2026 totals ~502 moonlighting shifts ($753K)
